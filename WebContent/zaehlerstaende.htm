<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
<script src="./js/jquery.js" type="text/javascript"></script>
<!-- Bootstrap core CSS -->
    <link href="./css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
	<input type="number" min="0" max="999999" id="messwert">
	<input type="date" id="ablesedatum">
	<input type="submit" value="Zählerstand speichern" id="speichern">
	<table id="Messwerte" class="table table-hover">
		<thead>
			<tr>
				<th>Ablesedatum</th>
				<th>Zählerstand</th>
			</tr>
		</thead>
		<tbody>

		</tbody>
	</table>



	<script type="text/javascript">
		var getUrlParameter = function getUrlParameter(sParam) {
			var sPageURL = decodeURIComponent(window.location.search
					.substring(1)), sURLVariables = sPageURL.split('&'), sParameterName, i;

			for (i = 0; i < sURLVariables.length; i++) {
				sParameterName = sURLVariables[i].split('=');

				if (sParameterName[0] === sParam) {
					return sParameterName[1] === undefined ? true
							: sParameterName[1];
				}
			}
		};
		
		function getMesswerte(){
			$.ajax({
				url : "api/zaehlerstaende?id=" + getUrlParameter("id"),
				context : document.body
			}).done(function(data) {
				$("#Messwerte > tbody").empty();
				var html = "";
				$.each(data, function(i, m) {
					html += "<tr><td>" + m.ablesedatum + "</td>";
					html += "<td>" + m.messwert + "</td></tr>";
				});
				$("#Messwerte > tbody").append(html);
			});
		};

		$(function() {
			// bisherige Zählerstände anzeigen
			getMesswerte();
			
			// neuen Zählerstand abspeichern und Tabelle neu laden
			$("#speichern").click( function(){
        		$.ajax({
        			url: "api/zaehlerstand?id=" + getUrlParameter("id") +"&ablesedatum="+$("#ablesedatum").val()+"&messwert="+$("#messwert").val()
        		}).done(function(){
        			getMesswerte();
        		});
        		
        	});
		});	
	</script>
 <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="<c:url value="/js/bootstrap.min.js"/>"></script>
</body>
</html>